<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Welcome to DGYM-HOME</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Archivo&display=swap");
    </style>
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../components/navbar.css" />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-storage.js"></script>
    <!-- firebase CDN -->
    <script src="../../config/config.js"></script>
    <script src="../../service/logincheck.js" defer></script>

    <style>
      * {
        /* border: 1px solid red; */
      }
    </style>

  <body
    class="d-flex flex-column min-vh-100"
    style="
      font-family: Archivo, sans-serif;
      background-color: rgba(0, 0, 0, 0.945);
    "
  >

  <!---------------------------------- navbar  Start------------------------------->
    <nav class="navbar navbar-expand-lg navbar-light navbar-custom">
      <div class="container-fluid">
        <a class="navbar-brand ms-4 text-light" href="../../../index.html"
          ><img src="../../img/logo-white.png" alt="짐로고" width="100"
        /></a>
        <button
          class="navbar-toggler custom-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul
            class="navbar-nav me-auto mb-2 mb-lg-0 container-fluid justify-content-center ms-4 mt-3"
            style="font-size: 1.2rem"
          >
            <li class="nav-item me-5">
              <a class="nav-link text-light" href="../aboutus/aboutus.html"
                >About Us</a
              >
            </li>
            <li class="nav-item me-5">
              <a class="nav-link text-light" href="../program/program.html"
                >Program</a
              >
            </li>
            <li class="nav-item me-5">
              <a class="nav-link text-light" href="../center/center.html"
                >Center</a
              >
            </li>
            <li class="nav-item me-5">
              <a class="nav-link text-light" href="../contact/contact.html"
                >Contact</a
              >
            </li>
              <li class="nav-item me-5">
              <a
                class="nav-link text-light"
                href="../notice/notice.html?page=1"
                >Notice</a
              >
            </li>
          </ul>
          <div class="d-flex mt-3 btn-group" style="width: 12rem">
            <a href="../../../login.html">
              <button
                type="button"
                class="btn btn-primary btn-sm me-1"
                id="login"
              >
                login
              </button>
            </a>
          </div>
        </div>
      </div>
    </nav>
    <!---------------------------------- navbar ------------------------------->
    <body>
      <div class="container-fluid d-flex flex-row">
    <!----------------------------------- sidebar start -------------------------------->
        <aside class="navbar navbar-expand-md navbar-light d-flex flex-column mt-5 ms-3">
          <ul class="navbar-nav flex-column text-center">
            <li class="mb-2">
              <a class="nav-link text-info" href="./membership.html">Membership</a>
            </li>
            <li class="mb-2">
              <a class="nav-link text-light" href="./inbody.html">Inbody</a>
            </li>
          </ul>            
        </aside>
    <!----------------------------------- sidebar end --------------------------------->
    <!----------------------------------- main start ---------------------------------->

    <main class="ps-0 ps-md-5 flex-grow-1">
      <div class="container col-md-8 col-lg-10 col-sm-10 bg-black box-shadow mt-md-5">
        <header class="col-12 text-white-50 d-flex justify-content-center mb-md-5">
          <h3>마이페이지</h3>
        </header>
        <article class="col-md-12 mx-auto pt-5 d-inline-block d-flex justify-content-center">
          <img src="../../img/default_img.png" alt="프로필사진" class="img" width="250" height="250">
          <div class="text-white-50 col-4 d-inline-block ms-md-5 mt-md-3">
            <p id="intro-start"></p> <!-- 가져온 데이터가 아래쪽으로 붙는 곳입니다. -->
            <!-- <p id="name">이름</p>
            <p id="phone">연락처</p>
            <p id="email">이메일</p>
            <p id="email">생년월일</p> -->
            <button type="button" class="btn btn-outline-dark btn-sm ms-sm-3 text-white btn-success" >수정하기</button>
            <button type="button" id="user_delete" class="btn btn-outline-dark btn-sm ms-sm-3 text-white btn-danger">탈퇴하기</button>
          </div>
          <!-- <div class="d-flex">
            <input type="file">
          </div> -->
          </article>
        </div>
      </main>
    </div>
    <!---------------------------------- main end ------------------------------------->
    <!----------------------------------  Footer start  ------------------------------->
      <footer class="footer mt-auto py-3">
        <div class="container d-md-flex flex-column align-items-center">
          <span class="text-muted" style="font-size: 0.1rem">
          (주)D-GYM ㅣ 대표: 김민준 ㅣ 주소: 서울특별시 강남구 테헤란로 14길 6
          5층~7층 ㅣ 등록번호 123-12-123456 ㅣ info@dgym.co.kr ㅣ 전화번호
          02-123-1234</span>
          <span class="text-muted" style="font-size: 0.1rem">
          ⓒ2022 Supplies.Inc. All rights reserved.</span>
        </div>
      </footer>
    <!--------------------------------- Footer End ----------------------------------->
    <script>
      const db = firebase.firestore();
      /*============= 가져오기 Start ============*/
      firebase.auth().onAuthStateChanged(function (user) {// 현재 로그인된 사용자 대조 api
        firebase.database().ref('users/' + user.uid).once("value").then(function (snapshot) {
          if (user) {
            // console.log(user.uid); // uid가져왔니??
            db.collection("user")
              .doc(user.uid)
              .get()
              .then((doc) => {
                  data = doc.data();
                  console.log(data);
                  /* ※ 전각공백문자가 포함되어 있습니다. ≒ &nbsp */
                  const template = `
                                  <p>이름   |  ${user.displayName}</p>
                                  <p>연락처  |  ${data.mem_hp}</p>
                                  <p>이메일  |  ${data.mem_email}</p>
                                  <p>생년월일 |  ${data.mem_birth !=null ? data.mem_birth : "" }</p>
                                  `;
           $("#intro-start").append(template);       
          })
        }
      })
      /*============== 가져오기 End =============*/
      /*=============== 삭제 Start ==============*/
      document.getElementById("user_delete").addEventListener('click', (e) => {
        // 탈퇴하기가 눌리면 Firestore의 문서를 먼저 삭제합니다.
        const ok = confirm("정말로 삭제하시겠습니까??")
        if(ok){
        db.collection("user").doc(user.uid).delete().then(() =>{
            console.log("Document successfully deleted!");
            // 문서삭제가 완료된 후 사용자 Authentication의 id가 삭제됩니다.
            user.delete().then(() => {
              alert('회원탈퇴 되었습니다. \n이용해주셔서 감사합니다.');
              window.location.replace("../../../login.html")
                }).catch((error) => {
                    console.log(error);
                  })
              })
            } else {
              alert("취소되었습니다.")
              console.log("삭제취소함");
            }

          });
        /*================ 삭제 End ===============*/
      })/////////////end of onAuthStateChanged
        
  
    
    </script>
  </body>
</html>